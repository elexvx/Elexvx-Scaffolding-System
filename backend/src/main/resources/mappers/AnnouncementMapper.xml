<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tencent.tdesign.mapper.AnnouncementMapper">
  <sql id="BaseSelect">
    SELECT id,
      title,
      summary,
      content,
      type,
      priority,
      status,
      cover_url,
      publish_at,
      created_at,
      updated_at,
      created_by_id,
      created_by_name,
      attachment_url,
      attachment_name,
      is_broadcasted AS broadcasted
    FROM announcements
  </sql>

  <select id="selectById" resultType="com.tencent.tdesign.entity.Announcement">
    <include refid="BaseSelect" />
    WHERE id = #{id}
  </select>

  <select id="selectPageByStatus" resultType="com.tencent.tdesign.entity.Announcement">
    <include refid="BaseSelect" />
    WHERE status IN
    <foreach collection="statuses" item="s" open="(" close=")" separator=",">
      #{s}
    </foreach>
    ORDER BY updated_at DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

  <select id="countByStatus" resultType="long">
    SELECT COUNT(1)
    FROM announcements
    WHERE status IN
    <foreach collection="statuses" item="s" open="(" close=")" separator=",">
      #{s}
    </foreach>
  </select>

  <select id="selectLatestPublished" resultType="com.tencent.tdesign.entity.Announcement">
    <include refid="BaseSelect" />
    WHERE status = 'published'
    ORDER BY publish_at DESC
    LIMIT #{limit}
  </select>

  <insert id="insert" parameterType="com.tencent.tdesign.entity.Announcement" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO announcements (
      title,
      summary,
      content,
      type,
      priority,
      status,
      cover_url,
      publish_at,
      created_at,
      updated_at,
      created_by_id,
      created_by_name,
      attachment_url,
      attachment_name,
      is_broadcasted
    )
    VALUES (
      #{title},
      #{summary},
      #{content},
      #{type},
      #{priority},
      #{status},
      #{coverUrl},
      #{publishAt},
      #{createdAt},
      #{updatedAt},
      #{createdById},
      #{createdByName},
      #{attachmentUrl},
      #{attachmentName},
      #{broadcasted}
    )
  </insert>

  <update id="update" parameterType="com.tencent.tdesign.entity.Announcement">
    UPDATE announcements
    SET
      title = #{title},
      summary = #{summary},
      content = #{content},
      type = #{type},
      priority = #{priority},
      status = #{status},
      cover_url = #{coverUrl},
      publish_at = #{publishAt},
      created_at = #{createdAt},
      updated_at = #{updatedAt},
      created_by_id = #{createdById},
      created_by_name = #{createdByName},
      attachment_url = #{attachmentUrl},
      attachment_name = #{attachmentName},
      is_broadcasted = #{broadcasted}
    WHERE id = #{id}
  </update>

  <delete id="deleteById">
    DELETE FROM announcements WHERE id = #{id}
  </delete>
</mapper>
